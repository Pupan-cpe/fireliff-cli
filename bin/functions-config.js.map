{"version":3,"sources":["../lib/functions-config.js"],"names":["FailedToGetConfig","error","FailedToGetConfigAuthError","info","verbose","join","EOL","FailedToGetConfigUnknownError","code","FunctionsConfig","BaseCommand","ErrorMessages","AccessToken","config","SingleChannelGroup","AccessTokenName","get","name","Promise","resolve","reject","command","ChildProcess","exec","output","parseGetConfigError","JSON","parse","jsonParseError","getNamesById","group","id","names","push","getIdByName","prop","parseName","toLowerCase","replace","errorMessage","Error","message","test","set","value","reload","then","unset"],"mappings":"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","sourcesContent":["import * as ChildProcess from 'child_process';\nimport { EOL } from 'os';\nimport './colors-set-theme';\n\nconst FailedToGetConfig = 'Failed to get configuration'.error;\nconst FailedToGetConfigAuthError = [\n    FailedToGetConfig,\n    'Suggestions:'.info,\n    'Your credentials are no longer valid. Please run firebase login --reauth'.verbose\n].join(EOL);\nconst FailedToGetConfigUnknownError = [\n    FailedToGetConfig,\n    'Suggestions:'.info,\n    `Run ${'firebase init'.code} to start a project directory in the current folder.`.verbose,\n    `Run ${'firebase use --add'.code} to set active project.`.verbose\n].join(EOL);\n\n/**\n * FunctionsConfig handle configuration in Firebase Functions\n */\nexport class FunctionsConfig {\n\n    static AccessTokenName = 'access_token';\n    static SingleChannelGroup = 'line';\n\n    static get BaseCommand() {\n        return 'firebase functions:config';\n    }\n\n    static get ErrorMessages() {\n        return {\n            FailedToGetConfig, FailedToGetConfigAuthError, FailedToGetConfigUnknownError\n        };\n    }\n\n    static get AccessToken() {\n        return FunctionsConfig.config[FunctionsConfig.SingleChannelGroup][FunctionsConfig.AccessTokenName];\n    }\n\n    static async get(name) {\n        return new Promise((resolve, reject) => {\n            let command = `${FunctionsConfig.BaseCommand}:get`;\n\n            if (name) {\n                command = `${command} ${name}`;\n            }\n\n            ChildProcess.exec(command, (error, output) => {\n                if (error) {\n                    return reject(FunctionsConfig.parseGetConfigError(error));\n                }\n\n                try {\n                    let config = JSON.parse(output);\n                    return resolve(config);\n                } catch (jsonParseError) {\n                    return reject(jsonParseError);\n                }\n            });\n        });\n    }\n\n    static async getNamesById(group, id, config) {\n        const names = [];\n\n        if (!config || !config[group]) {\n            config = await FunctionsConfig.get();\n        }\n\n        if (config && config[group]) {\n            for (let name in config[group]) {\n                if (config[group][name] === id) {\n                    names.push(name);\n                }\n            }\n        }\n\n        return names;\n    }\n\n    static async getIdByName(group, name, config) {\n        if (!config || !config[group]) {\n            config = await FunctionsConfig.get();\n        }\n\n        if (config && config[group]) {\n            for (let prop in config[group]) {\n                if (prop === name) {\n                    return config[group][prop];\n                }\n            }\n        }\n        return null;\n    }\n\n    static parseName(name) {\n        return name.toLowerCase().replace(/\\s/g, '_');\n    }\n\n    /**\n     * \n     * @param {Error|string} error \n     * @return {string} error message intented to be used in console.log\n     */\n    static parseGetConfigError(error) {\n        let errorMessage = (error instanceof Error) ? error.message : error;\n\n        if (/Authentication Error/.test(errorMessage)) {\n            return FunctionsConfig.ErrorMessages.FailedToGetConfigAuthError;\n        } else {\n            return FunctionsConfig.ErrorMessages.FailedToGetConfigUnknownError;\n        }\n    }\n\n    static async set(name, value) {\n        return new Promise((resolve, reject) => {\n            ChildProcess.exec(`${FunctionsConfig.BaseCommand}:set ${name}=${value}`, (error) => {\n                if (error) {\n                    return reject(error);\n                }\n                return resolve(value);\n            });\n        });\n    }\n\n    static reload() {\n        return FunctionsConfig.get().then(config => FunctionsConfig.config = config);\n    }\n\n    static async unset(name) {\n        return new Promise((resolve, reject) => {\n            ChildProcess.exec(`${FunctionsConfig.BaseCommand}:unset ${name}`, (error) => {\n                if (error) {\n                    return reject(error);\n                }\n                return resolve(name);\n            });\n        });\n    }\n\n}\n"],"file":"functions-config.js"}