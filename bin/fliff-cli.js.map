{"version":3,"sources":["../lib/fliff-cli.js"],"names":["commandLineArgs","require","operation","_unknown","name","defaultOption","stopAtFirstUnknown","argv","options","type","String","alias","Boolean","indexOf","then","config","accessToken","line","access_token","fliff","FLIFF","viewNames","data","req","res","LIFFAddRequest","view","url","console","log","verbose","send","error","process","exit","input","liffId","info","LIFFConfig","setView","help","code","LIFFDeleteRequest","id","warn","prompt","getViewIdByName","response","message","getViewNamesById","Promise","all","map","viewName","unsetView","LIFFGetRequest","table","apps","app","views","Object","keys","filter","key","join","update","rsUpdate","catch","errUpdate","init","path","resolve","cwd","pjson","version"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\nimport 'console.table';\nimport * as path from 'path';\nimport pjson from '../package.json';\nimport { LIFFAddRequest, LIFFConfig, LIFFDeleteRequest, LIFFGetRequest } from '.';\nimport { getValidatedConfig } from './shared';\nimport { FLIFF } from './fliff.js';\n\nconst commandLineArgs = require('command-line-args');\nconst { operation, _unknown } = commandLineArgs([\n    { name: 'operation', defaultOption: true }\n], { stopAtFirstUnknown: true });\nconst argv = _unknown || [];\nconst options = commandLineArgs([\n    { name: 'ble', type: String },\n    { name: 'description', type: String },\n    { name: 'id', type: String },\n    { name: 'name', type: String },\n    { name: 'type', type: String },\n    { name: 'url', type: String },\n    { name: 'version', alias: 'v', type: Boolean }\n], { argv });\n\n// Commands that need Functions config\nif (['add', 'update', 'delete', 'get'].indexOf(operation) > -1) {\n    getValidatedConfig().then(async (config) => {\n        const accessToken = config.line.access_token;\n        const fliff = new FLIFF();\n        let viewNames;\n        let data;\n        let req;\n        let res;\n\n        switch (operation) {\n            case 'add':\n                req = new LIFFAddRequest({ accessToken });\n                data = {\n                    view: {\n                        type: options.type,\n                        url: options.url\n                    }\n                };\n                try {\n                    console.log('Sending request to add LIFF view...'.verbose);\n                    res = await req.send(data);\n                } catch (error) {\n                    console.log(`Failed to add LIFF view`.error);\n                    console.error(error);\n                    process.exit(1);\n                }\n\n                try {\n                    console.log(`Created ${options.name.input} view with LIFF ID: ${res.data.liffId.info}`.verbose);\n                    await LIFFConfig.setView(options.name, res.data.liffId);\n                } catch (error) {\n                    console.log(`Failed to set Functions configuration`.error);\n                    console.log(`Try re-run with the following command`.help);\n                    console.log(`firebase functions:config:set views.${options.name}=${res.data.liffId}`.code);\n                    console.error(error);\n                    process.exit(1);\n                }\n\n                break;\n\n            case 'delete':\n                req = new LIFFDeleteRequest({ accessToken });\n                if (!options.id && !options.name) {\n                    console.warn(`Command ${'fliff delete'.prompt} required LIFF ID or name option`.warn);\n                    console.log(`Try re-run ${'fliff delete --id <liffId>'.input} OR  ${'fliff delete --name <viewName>'.input}`.help);\n                    process.exit(1);\n                }\n\n                if (options.name) {\n                    options.id = await LIFFConfig.getViewIdByName(options.name, config);\n                    if (typeof options.id !== 'string') {\n                        console.error(`Failed to retrieve LIFF ID with view name ${options.name.input}`.error);\n                        process.exit(1);\n                    }\n                }\n\n                try {\n                    console.log(`Sending request to delete LIFF view ${options.id.input}`.verbose);\n                    res = await req.send(options.id);\n                    console.log(`Deleted view with LIFF ID: ${options.id.input}`.verbose);\n                } catch (error) {\n                    if (error.response && error.response.data) {\n                        if (error.response.data.message === 'not found') {\n                            console.log('LIFF app not found'.info);\n                        } else {\n                            console.log(`Failed to delete LIFF view ${options.id.input}`.error);\n                            console.error(error.response.data.error);\n                            process.exit(1);\n                        }\n                    } else {\n                        console.log(`Failed to delete LIFF view ${options.id.input}`.error);\n                        console.error(error);\n                        process.exit(1);\n                    }\n                }\n\n                try {\n                    viewNames = await LIFFConfig.getViewNamesById(options.id, config);\n                    await Promise.all(viewNames.map(viewName => LIFFConfig.unsetView(viewName)));\n                    console.log(`Unset view(s) in Functions configuration`.info, viewNames);\n                } catch (error) {\n                    console.log(`Failed to unset view(s) in Functions configuration`.error);\n                    console.log(`Try looking for view name with LIFF ID ${options.id.input} using ${'fliff get'.prompt} command and unset it manually`.help);\n                    console.log(`firebase functions:config:unset views.<viewName>`.code);\n                    console.error(error);\n                    process.exit(1);\n                }\n                break;\n\n            case 'get':\n                req = new LIFFGetRequest({ accessToken });\n                try {\n                    console.log('Sending request to get LIFF view(s)...'.verbose);\n                    res = await req.send();\n                    console.table(res.data.apps.map(app => {\n                        const views = Object.keys(config.views).filter(key => {\n                            return config.views[key] === app.liffId;\n                        });\n\n                        return {\n                            'View': views.join(', '),\n                            'LIFF ID': app.liffId,\n                            'Type': app.view.type,\n                            'URL': app.view.url\n                        };\n                    }));\n                } catch (error) {\n                    if (error.response && error.response.data) {\n                        if (error.response.data.message === 'no apps') {\n                            console.log('LIFF app not found'.info);\n                            process.exit(0);\n                        } else {\n                            console.error(error.response.data.error);\n                            process.exit(1);\n                        }\n                    } else {\n                        console.error(error);\n                        process.exit(1);\n                    }\n                }\n\n                break;\n\n            case 'update':\n                console.log(`Sending request to update LIFF view`.verbose);\n                fliff.update(options)\n                    .then(rsUpdate => {\n                        console.log(`Updated LIFF ID: ${options.id.input}`.verbose);\n\n                        return rsUpdate;\n                    })\n                    .catch(errUpdate => {\n                        console.log(errUpdate);\n                        process.exit(1);\n                    });\n                break;\n\n            default:\n\n        }\n\n    });\n} else if (operation) {\n    switch (operation) {\n        case 'init':\n            FLIFF.init(path.resolve(process.cwd(), 'web-views'));\n            break;\n        case 'version':\n            console.log(`Version: ${pjson.version}`);\n            break;\n        case 'help':\n        default:\n            // TODO: Display help message\n    }\n} else if (options.version) {\n    console.log(`Version: ${pjson.version}`);\n}\n"],"file":"fliff-cli.js"}