{"version":3,"sources":["../lib/things-cli.js"],"names":["versionText","pjson","version","help","commandLineArgs","require","commandLineUsage","operation","_unknown","name","defaultOption","stopAtFirstUnknown","argv","options","alias","type","String","Boolean","things","Things","test","console","log","getUsage","createUsage","deleteUsage","thingsUsage","process","exit","indexOf","liff","product","error","prompt","warn","EOL","input","user","device","then","validateConfig","createTrialProduct","result","deleteTrialProduct","getDevicesByProductUser","getDeviceByDeviceUser","getProduct","getTrialProducts","catch","debug","response","message","toString","commandError"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\nimport 'console.table';\nimport { EOL } from 'os';\nimport './colors-set-theme';\nimport thingsUsage, { createUsage, deleteUsage, getUsage } from './things-cli-usage';\nimport { commandErrorHandler, getConfig, validateConfig } from './shared';\nimport { Things } from './things.js';\nimport pjson from '../package.json';\n\nconst versionText = `Things CLIs v${pjson.version} for Things API v1`.help;\n\ntry {\n    const commandLineArgs = require('command-line-args');\n    const commandLineUsage = require('command-line-usage');\n\n    const { operation, _unknown } = commandLineArgs([\n        { name: 'operation', defaultOption: true }\n    ], { stopAtFirstUnknown: true });\n    const argv = _unknown || [];\n    const options = commandLineArgs([\n        { name: 'device', alias: 'd', type: String },\n        { name: 'help', alias: 'h', type: Boolean },\n        { name: 'id', type: String },\n        { name: 'liff', alias: 'l', type: String },\n        { name: 'name', alias: 'n', type: String },\n        { name: 'product', alias: 'p', type: String },\n        { name: 'user', alias: 'u', type: String },\n        { name: 'version', alias: 'v', type: Boolean },\n        { name: 'debug', type: Boolean }\n    ], { argv });\n\n    const things = new Things();\n\n    if (options.help) {\n        if (/^get/.test(operation)) {\n            console.log(commandLineUsage(getUsage));\n        } else if (/^create/.test(operation) || /^add/.test(operation)) {\n            console.log(commandLineUsage(createUsage));\n        } else if (/^delete/.test(operation) || /^remove/.test(operation) || /^rm/.test(operation)) {\n            console.log(commandLineUsage(deleteUsage));\n        } else {\n            console.log(commandLineUsage(thingsUsage));\n        }\n        process.exit(0);\n    }\n\n    if (['create:trial', 'delete:trial', 'get:device', 'get:product', 'get:trial'].indexOf(operation) > -1) {\n\n        switch (operation) {\n            case 'create:trial':\n                if (!options.liff || !options.product) {\n                    console.error(`Command ${'things create:trial'.prompt} required LIFF ID and product name`.warn + EOL +\n                        `Try re-run with option ${'--liff <liffId>'.input} and ${'--product <productName>'.input}`.help);\n                    process.exit(1);\n                }\n                break;\n\n            case 'delete:trial':\n                if (!options.product) {\n                    console.error(`Command ${'things delete:trial'.prompt} required Product ID`.warn + EOL +\n                        `Try re-run with option ${'--product <productId>'.input}`.help);\n                    process.exit(1);\n                }\n                break;\n\n            case 'get:device':\n                if (\n                    (!options.user && !options.product) ||\n                    (!options.user && !options.device)\n                ) {\n                    console.error(`Command ${'things get:device'.prompt} required User ID together with either product ID or device ID`.warn + EOL +\n                        `Try re-run with option ${'--user <userId>'.input}, and  ${'--product <productId>'.input} OR  ${'--device <deviceId>'.input}`.help);\n                    process.exit(1);\n                }\n                break;\n\n            case 'get:product':\n                if (!options.device) {\n                    console.error(`Command ${'things get:product'.prompt} required Device ID option`.warn + EOL +\n                        `Try re-run with option ${'--device <deviceId>'.input}`.help);\n                    process.exit(1);\n                }\n                break;\n        }\n\n        getConfig()\n            .then(validateConfig)\n            .then(() => {\n\n                switch (operation) {\n                    case 'create:trial':\n                        return things.createTrialProduct(options.liff, options.product)\n                            .then(result => {\n                                console.log(result);\n                                return;\n                            });\n\n                    case 'delete:trial':\n                        return things.deleteTrialProduct(options.product)\n                            .then(result => {\n                                console.log(result);\n                                return;\n                            });\n\n                    case 'get:device':\n                        if (options.product) {\n                            return things.getDevicesByProductUser(options.product, options.user)\n                                .then(result => {\n                                    console.log(result);\n                                    return;\n                                });\n                        } else {\n                            return things.getDeviceByDeviceUser(options.device, options.user)\n                                .then(result => {\n                                    console.log(result);\n                                    return;\n                                });\n                        }\n\n                    case 'get:product':\n                        return things.getProduct(options.device)\n                            .then(result => {\n                                console.log(result);\n                                return;\n                            });\n\n                    case 'get:trial':\n                        return things.getTrialProducts()\n                            .then(result => {\n                                console.log(result);\n                                return;\n                            });\n                }\n\n                return;\n            })\n            .catch(error => {\n                if (options.debug) {\n                    console.log('Response', error.response);\n                }\n\n                console.error(error.message || error.toString());\n                process.exit(1);\n            });\n\n    } else if (operation) {\n        switch (operation) {\n            case 'version':\n                console.log(versionText);\n                break;\n            case 'help':\n            default:\n                console.log(commandLineUsage(thingsUsage));\n        }\n    } else if (options.version) {\n        console.log(versionText);\n    } else {\n        console.log(commandLineUsage(thingsUsage));\n    }\n} catch (commandError) {\n    commandErrorHandler(commandError);\n}\n"],"file":"things-cli.js"}